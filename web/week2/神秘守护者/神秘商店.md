# 原版

每个用户初始金额为100，flag售价为10000，并且存在转账功能，所以就出现了很多人用的解法

写脚本批量注册100个账户，把这100个账户的钱全部转到一个人账户上，这样就有钱购买flag了

有趣的是，在出这道题的时候我想到了有人会这样做，但是想着大家应该没这么无聊，顶多有几个人会这样做，没想到一问发现大家都是这样做的，于是就有了番外篇

# 番外篇

为了避免出现原版的情况，我将所有人的初始金额设置为0了，这下只能寻找其他突破口。既然要找到系统的漏洞，那么肯定先要弄明白系统的功能点。首先除了最开始已经弄明白的注册和转账，还有一个留言板的功能没有测试，如果你稍加尝试就会发现这里存在xss，但是有一点点过滤

```python
@app.route('/comment', methods=['POST'])
def comment():
    content = request.form['content']
    
    content_lower = content.lower()
    if '<script' in content_lower or 'src' in content_lower or 'img' in content_lower or 'body' in content_lower:
        flash('你的输入有点危险哦~')
        return redirect(url_for('index'))
        
    username = session.get('username', 'Anonymous')
    conn = get_db_connection()
    conn.execute("INSERT INTO comments (username, content) VALUES (?, ?)", (username, content))
    conn.commit()
    conn.close()
    return redirect(url_for('index'))

```

很明显on属性都没有ban，有很多可以用的payload，这里给出我用的

```
<link rel="stylesheet" href="xxxx">
```

那么我们接下来就需要思考如何利用xss让我们获得足够的钱了，这里可能有一丢丢的脑洞，不难想到管理员肯定有足够的钱，我们可以利用xss让管理员给我们转钱，本质上就是让管理员访问transfer接口，我们需要先看一下转账的格式

![image-20251208195900571](神秘商店/image-20251208195900571.png)

一个实现的很简单的接口，和我兴趣小组讲的一模一样

于是得到最终payload（）

```
<link rel="stylesheet" href="/transfer?to=你注册的名字&amount=10000">
```

最后解释一下这题的设计，大家就能很好的理解这个流程了：

除了正常运行的系统之外，后台有一个一直运行的bot，每隔15秒他就会以管理员的身份登录并访问一次留言板页面，因为留言板存在xss，触发了我们的payload，他就会访问转账的接口，把钱转给我们（bot只有100w，如果你让他转的太多会转账失败）