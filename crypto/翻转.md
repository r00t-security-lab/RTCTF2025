## 翻转

### 题目描述

本来是作为签到的小游戏，现在看看放在这里也挺好，简单不烧脑，就是这密码我这辈子大概爆不出来了。没关系，我已经勘破校验漏洞了，现在只需一个合适的账号。。。

### 解题思路

小游戏无所谓，非常简单，我猜你玩不通过。通过直接修改get请求的方式改成100，则会返回提示只有admin用户才可以获得flag，那么关键点就在如何获得admin权限了。

分析代码，注意到维持用户登录状态保持交互所使用的是cookie，其中第一块内容便是用户名，如果能破解加密算法就very good了。

可是，加密算法采用了aes，常规情况下是不用考虑强行破解aes算法本身的（你能破解出来你就是下一个密码学院士，说不定还能拿哥德尔奖和菲尔兹奖，而且市面上aes加密也是常见手段）。

不过，我们注意到，这个aes工作的模式是cbc模式，这时候想到cbc翻转（我题目名和提示都明示了）。而本题在最后校验是否为admin的时候并未检测密码是否符合，那么操作就是将用户名改为admin。

不过，这里需要注意，虽然cbc翻转攻击可以改变用户名，但是不能改变明文的长度，而且修改越小越好。所以，最好的方式是将用户名命名为类似`adm1n`的样子。这样就只用改变一个字节了。

所以，处理脚本如下：

```python
import base64
import hashlib
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad

AES_KEY = hashlib.sha256(b'my-secret-aes-key').digest()
def decrypt_aes_cbc(encrypted_data):
    """AES CBC解密"""
    try:
        data = base64.b64decode(encrypted_data)
        iv = data[:16]
        print(iv)
        ciphertext = data[16:]
        cipher = AES.new(AES_KEY, AES.MODE_CBC, iv)
        decrypted = unpad(cipher.decrypt(ciphertext), AES.block_size)
        return decrypted.decode('utf-8')
    except Exception as e:
        return None

a = 'lOOtvM8II7nXcBtu9ZxCgqLrvaeSPWnZT2RAUlCh3GcneA0i2puGZg4jBRkER7sn'
print(decrypt_aes_cbc(a))

msg = base64.b64decode(a)
msg = msg[:5]+(int.to_bytes(msg[5]^ord('a')^ord('1')))+msg[6:]
a = base64.b64encode(msg)
print(a)

print(decrypt_aes_cbc(a))
```

使用该脚本改变cookie密文并重新保存，就可以在再次赢得画图挑战的时候获得flag了。

### 出题思路

考察cbc翻转的简单攻击，也是我在兴趣小组的时候讲过的，本次考察的还只是修改iv，并没有涉及在修改后部分区块后再修改第一区块。